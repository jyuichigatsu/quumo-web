# 要件定義 v0.1

## 1. プロジェクト概要

### プロジェクト名
QuuMo-web

### 目的・背景
複数メーカーの来店計測データ（例：RetailNext、Actcast、Safie ONE等）を一元管理し、店舗運営者が容易に傾向分析・比較できるダッシュボードを提供する。

**現状の課題**
- 各計測機器の特性によるデータの偏り（例：RetailNextは入店計測は高精度だが、年代性別の属性取得が不可）
- 異なるプラットフォームのデータを手動で集計する必要がある
- 機器の設定がユーザー自身で行えない、または難解
- 一部の計測機器にはダッシュボード機能が付随していない

### 想定ユーザー（ペルソナ）
- 中小規模の小売店舗運営者
- 複数店舗を管理する商業施設運営担当者
- イベント・ポップアップストア運営担当者
- 店舗計測に興味はあるが導入に躊躇している潜在ユーザー

**利用シーン**
- 毎日の店舗データ確認
- 新店舗出店時のデータ分析

### 提供価値（バリュープロポジション）
- 異なるセンサーから得た来店データをまとめて閲覧・比較可能
- 分析スキルがなくても簡単に傾向把握ができるシンプルUI
- 導入・運用コストを抑え、すぐに使い始められる環境を提供
- 複数データソースの組み合わせによる高度な分析（例：店舗前通行量と入店数の組み合わせによる入店率分析）

## 2. 機能要件（Functional Requirements）

### 2.1 データ連携
- RetailNextデータ取得API連携
- Actcastデータ取得API連携
- Safie ONEデータ取得API連携
- POSシステム（ユビレジ等）API連携
- シフト管理システム連携
- 天候データ連携
- データ形式の正規化（各サービス間の項目マッピング）
- データ取得の定期スケジューリング（1時間間隔）

**データ取得・更新方式**
- APIからのPUSH受信（対応APIの場合）
- 1時間間隔でのGETリクエスト（PUSH非対応の場合）
- 前日データは夜間集計し中間DBを作成

**ユーザーストーリー例**
- 管理者として、RetailNextとActcastのデータを自動で取り込みたい。なぜなら、毎回手動でインポートする手間を省きたいからだ。

**受け入れ基準**
- RetailNextとActcastから自動でデータ取得できること
- データ取得失敗時にはエラーログが記録されること

### 2.2 ダッシュボード機能
- 日別・時間帯別来店数グラフの表示
- エリアマップ機能（ユーザーが平面図をアップロードし、自由にエリアを描画）
- デバイス別、店舗別、期間別フィルター
- データ比較機能（例：前週比、前月比）
- CSV形式でのデータエクスポート機能
- ファネル図表示（店舗前通行量から購買数まで）

**必須分析指標**
- 店舗前通行量
- 入店数
- 入店率（入店数÷店舗前通行量）
- エリア滞在数
- エリア滞在率（エリア滞在数 ÷ 入店数）
- 購買数
- 購買率（入店数÷購買数）

**ユーザーストーリー例**
- 店舗運営者として、特定店舗の来店数推移を直感的なグラフで見たい。なぜなら、曜日や時間帯ごとの傾向をすぐに把握したいからだ。
- 店舗運営者として、前週比で来店数がどう変わったかを簡単に比較したい。なぜなら、施策の効果検証に活用したいからだ。

**受け入れ基準**
- グラフが直感的に操作できること（拡大・縮小・期間選択）
- フィルターによる店舗・期間・デバイス切り替えが可能なこと
- データをCSV形式でダウンロードできること

### 2.3 アカウント管理
- 新規アカウント登録（管理者、システム担当者、エリア担当、店舗担当、代理店）
- ログイン・ログアウト機能（セッション管理）
- パスワードリセット（メール送信）
- クライアントごとの権限管理

**ユーザーストーリー例**
- 新しいスタッフとして、自分用のアカウントを作成したい。なぜなら、個別にログイン管理をしたいからだ。
- 既存ユーザーとして、パスワードを忘れたときに自分でリセットできるようにしたい。なぜなら、サポートへの問い合わせを減らしたいからだ。

**受け入れ基準**
- 新規アカウント登録画面があること
- ログイン・ログアウトが正常に動作すること
- パスワードリセットリンクがメールで送信されること

### 2.4 通知機能（Optional）
- 異常検知時（例：来店数急減）アラート通知
- 月次レポート自動生成・配信（PDF/Email）

**ユーザーストーリー例**
- 店舗マネージャーとして、来店数が急減したときに即時通知を受け取りたい。なぜなら、原因調査や対策を迅速に行いたいからだ。
- オーナーとして、毎月まとめレポートを自動で受け取りたい。なぜなら、定例会議用の資料作成工数を減らしたいからだ。

**受け入れ基準**
- 来店数急減アラートが設定した閾値に基づき送信されること
- 月次レポートがPDFまたはメールで受信できること

## 3. 非機能要件（Non-Functional Requirements）

### 3.1 パフォーマンス
- ダッシュボード初回ロード時間：3秒以内
- データ更新間隔：15分毎（段階的に短縮検討）

### 3.2 セキュリティ
- 全通信HTTPS必須
- Firebase Authenticationによる認証・認可管理
- 各APIキー管理（環境変数管理）
- 一般的な機密保持対策の実施

### 3.3 スケーラビリティ
- 100店舗以上のスムーズなデータ集計・表示
- 同時アクセス100ユーザー規模に耐える設計

### 3.4 可用性
- サーバー稼働率99%以上を目指す
- 毎日のデータバックアップを自動実施

### 3.5 保守性
- ソースコードはGitHubでバージョン管理
- Vercelで自動デプロイ（CI/CD）
- エラーモニタリングにSentryを導入検討

## 4. 想定する外部サービス・ミドルウェア
- Google Cloud Platform
  - Cloud Run（APIサーバー）
  - BigQuery（データ格納・分析）
  - Cloud Scheduler（定期データ取得）
- Firebase Authentication（ログイン認証）
- Vercel（フロントエンドホスティング）
- Sentry（エラーログ監視）
- RetailNext API
- Actcast API

## 5. リスクと対応方針

### 5.1 データソースの仕様変更
- RetailNext/Actcast API仕様変更リスク → API仕様チェックの定期タスクを設定

### 5.2 データ取得失敗
- 取得失敗時のリトライ設計、リカバリログ保存

### 5.3 外部APIコスト上昇リスク
- API利用量のモニタリング、閾値超過時アラート設定

---

以上。

